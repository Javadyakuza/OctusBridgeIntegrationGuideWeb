"use strict";function objectAssignPolyfill(){"function"!=typeof Object.assign&&(Object.assign=function(e,t){var n=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),o=1;o<arguments.length;o++){var i=n[o];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])}return r})}function objectKeysPolyfill(){var e,t,n,r;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(o){if("function"!=typeof o&&("object"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var i,s,a=[];for(i in o)e.call(o,i)&&a.push(i);if(t)for(s=0;s<r;s++)e.call(o,n[s])&&a.push(n[s]);return a}))}Object.defineProperty(exports,"__esModule",{value:!0});var supportsCookies=function(){try{return Boolean(navigator.cookieEnabled)}catch(e){return!1}},supportsSendBeacon=function(){try{return Boolean(navigator.sendBeacon)}catch(e){return!1}},supportsXMLHttpRequest=function(){try{return Boolean(XMLHttpRequest)}catch(e){return!1}},supportsNodeHttpModule=function(){try{var e=require("http").request,t=require("https").request;return Boolean(e)&&Boolean(t)}catch(e){return!1}},isUndefined=function(e){return void 0===e},isString=function(e){return"string"==typeof e},isNumber=function(e){return"number"==typeof e},isFunction=function(e){return"function"==typeof e};function makeSendEvent(e){return function(t,n,r){var o,i,s;if(!this._userHasOptedOut){if(!(!isUndefined(this._apiKey)&&!isUndefined(this._appId)||(null===(o=r)||void 0===o?void 0:o.headers["X-Algolia-Application-Id"])&&(null===(i=r)||void 0===i?void 0:i.headers["X-Algolia-API-Key"])))throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with appId and apiKey parameters or provide custom credentials in additional parameters.");if(""===n.userToken||""===this._userToken)throw new Error("`userToken` cannot be an empty string.");var a=n.userToken||this._userToken;if(isUndefined(a))throw new Error("Before calling any methods on the analytics, you first need to call 'setUserToken' function or include 'userToken' in the event payload.");if(!isString(n.index))throw new TypeError("expected required parameter `index` to be a string");if(!isString(n.eventName))throw new TypeError("expected required parameter `eventName` to be a string");if(!isUndefined(n.userToken)&&!isString(n.userToken))throw new TypeError("expected optional parameter `userToken` to be a string");var c={eventType:t,eventName:n.eventName,userToken:a,index:n.index};if(!isUndefined(n.timestamp)){if(!isNumber(n.timestamp))throw new TypeError("expected optional parameter `timestamp` to be a number");c.timestamp=n.timestamp}if(!isUndefined(n.queryID)){if(!isString(n.queryID))throw new TypeError("expected optional parameter `queryID` to be a string");c.queryID=n.queryID}if(!isUndefined(n.objectIDs)){if(!Array.isArray(n.objectIDs))throw new TypeError("expected optional parameter `objectIDs` to be an array");c.objectIDs=n.objectIDs}if(!isUndefined(n.positions)){if(!Array.isArray(n.positions))throw new TypeError("expected optional parameter `positions` to be an array");if(isUndefined(n.objectIDs))throw new Error("cannot use `positions` without providing `objectIDs`");if(n.objectIDs.length!==n.positions.length)throw new Error("objectIDs and positions need to be of the same size");c.positions=n.positions}if(!isUndefined(n.filters)){if(!isUndefined(n.objectIDs))throw new Error("cannot use `objectIDs` and `filters` for the same event");if(!Array.isArray(n.filters))throw new TypeError("expected optional parameter `filters` to be an array");c.filters=n.filters}if(isUndefined(n.objectIDs)&&isUndefined(n.filters))throw new Error("expected either `objectIDs` or `filters` to be provided");return bulkSendEvent(e,this._appId,this._apiKey,this._uaURIEncoded,this._endpointOrigin,[c],null===(s=r)||void 0===s?void 0:s.headers)}}}function bulkSendEvent(e,t,n,r,o,i,s){void 0===s&&(s={});var a=Object.assign({"X-Algolia-Application-Id":t,"X-Algolia-API-Key":n,"X-Algolia-Agent":r},s);return e(o+"/1/events?"+Object.keys(a).map(function(e){return e+"="+a[e]}).join("&"),{events:i})}function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}var version="1.10.0",DEFAULT_ALGOLIA_AGENT="insights-js ("+version+")";function addAlgoliaAgent(e){-1===this._ua.indexOf("; "+e)&&(this._ua+="; "+e,this._uaURIEncoded=encodeURIComponent(this._ua))}var createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},COOKIE_KEY="_ALGOLIA",MONTH=2592e6,setCookie=function(e,t,n){var r=new Date;r.setTime(r.getTime()+n);var o="expires="+r.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"},getCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return""};function setAnonymousUserToken(){if(supportsCookies()){var e=getCookie(COOKIE_KEY);e&&""!==e&&0===e.indexOf("anonymous-")?this.setUserToken(e):(this.setUserToken("anonymous-"+createUUID()),setCookie(COOKIE_KEY,this._userToken,this._cookieDuration))}}function setUserToken(e){this._userToken=e,isFunction(this._onUserTokenChangeCallback)&&this._onUserTokenChangeCallback(this._userToken)}function getUserToken(e,t){return isFunction(t)&&t(null,this._userToken),this._userToken}function onUserTokenChange(e,t){this._onUserTokenChangeCallback=e,t&&t.immediate&&isFunction(this._onUserTokenChangeCallback)&&this._onUserTokenChangeCallback(this._userToken)}objectAssignPolyfill();var SUPPORTED_REGIONS=["de","us"];function init(e){var t;if(void 0===e&&(e={}),!isUndefined(e.region)&&-1===SUPPORTED_REGIONS.indexOf(e.region))throw new Error("optional region is incorrect, please provide either one of: "+SUPPORTED_REGIONS.join(", ")+".");if(!(isUndefined(e.cookieDuration)||isNumber(e.cookieDuration)&&isFinite(e.cookieDuration)&&Math.floor(e.cookieDuration)===e.cookieDuration))throw new Error("optional cookieDuration is incorrect, expected an integer.");setOptions(this,e,{_userHasOptedOut:!!e.userHasOptedOut,_region:e.region,_useCookie:(t=e.useCookie,null===t||void 0===t||t),_cookieDuration:e.cookieDuration||6*MONTH}),this._endpointOrigin=e.region?"https://insights."+e.region+".algolia.io":"https://insights.algolia.io",this._ua=DEFAULT_ALGOLIA_AGENT,this._uaURIEncoded=encodeURIComponent(DEFAULT_ALGOLIA_AGENT),e.userToken?this.setUserToken(e.userToken):this._userToken||this._userHasOptedOut||!this._useCookie||this.setAnonymousUserToken()}function setOptions(e,t,n){var r=t.partial,o=__rest(t,["partial"]);r||Object.assign(e,n),Object.assign(e,Object.keys(o).reduce(function(e,t){var n;return Object.assign(Object.assign({},e),((n={})["_"+t]=o[t],n))},{}))}function get(e,t){t(this[e])}function initSearch(e){if(isUndefined(this._apiKey)||isUndefined(this._appId))throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with appId and apiKey parameters");if(!e)throw new Error("initSearch function requires an argument with getQueryID and hitsContainer arguments");if(!e.getQueryID||"function"!=typeof e.getQueryID)throw new Error("getQueryID must be a function that returns the queryID of the last search operation");this.getQueryID=e.getQueryID}function getVersion(e){isFunction(e)&&e(this.version)}function clickedObjectIDsAfterSearch(e,t){if(!e)throw new Error("No params were sent to clickedObjectIDsAfterSearch function, please provide `queryID`,  `objectIDs` and `positions` to be reported");if(!e.queryID)throw new Error("required queryID parameter was not sent, click event can not be properly sent without");if(!e.objectIDs)throw new Error("required objectIDs parameter was not sent, click event can not be properly sent without");if(!e.positions)throw new Error("required positions parameter was not sent, click event can not be properly sent without");this.sendEvent("click",e,t)}function clickedObjectIDs(e,t){if(!e)throw new Error("No params were sent to clickedObjectIDs function, please provide `objectIDs` to be reported");if(!e.objectIDs)throw new Error("required `objectIDs` parameter was not sent, click event can not be properly sent without");this.sendEvent("click",e,t)}function clickedFilters(e,t){if(!e)throw new Error("No params were sent to clickedFilters function, please provide `filters` to be reported");if(!e.filters)throw new Error("required `filters` parameter was not sent, click event can not be properly sent without");this.sendEvent("click",e,t)}function convertedObjectIDsAfterSearch(e,t){if(!e)throw new Error("No params were sent to convertedObjectIDsAfterSearch function, please provide `queryID` and `objectIDs` to be reported");if(!e.queryID)throw new Error("required queryID parameter was not sent, conversion event can not be properly sent without");if(!e.objectIDs)throw new Error("required objectIDs parameter was not sent, conversion event can not be properly sent without");this.sendEvent("conversion",e,t)}function convertedObjectIDs(e,t){if(!e)throw new Error("No params were sent to convertedObjectIDs function, please provide `objectIDs` to be reported");if(!e.objectIDs)throw new Error("required objectIDs parameter was not sent, conversion event can not be properly sent without");this.sendEvent("conversion",e,t)}function convertedFilters(e,t){if(!e)throw new Error("No params were sent to convertedFilters function, please provide `filters` to be reported");if(!e.filters)throw new Error("required filters parameter was not sent, conversion event can not be properly sent without");this.sendEvent("conversion",e,t)}function viewedObjectIDs(e,t){if(!e)throw new Error("No params were sent to viewedObjectIDs function, please provide `objectIDs` to be reported");if(!e.objectIDs)throw new Error("required objectIDs parameter was not sent, view event can not be properly sent without");this.sendEvent("view",e,t)}function viewedFilters(e,t){if(!e)throw new Error("No params were sent to viewedFilters function, please provide `filters` to be reported");if(!e.filters)throw new Error("required filters parameter was not sent, view event can not be properly sent without");this.sendEvent("view",e,t)}objectKeysPolyfill(),objectAssignPolyfill();var AlgoliaAnalytics=function(e){var t=e.requestFn;this._endpointOrigin="https://insights.algolia.io",this._userHasOptedOut=!1,this._useCookie=!1,this._cookieDuration=6*MONTH,this._ua="",this._uaURIEncoded="",this.version=version,this.sendEvent=makeSendEvent(t).bind(this),this.init=init.bind(this),this.initSearch=initSearch.bind(this),this.addAlgoliaAgent=addAlgoliaAgent.bind(this),this.setUserToken=setUserToken.bind(this),this.setAnonymousUserToken=setAnonymousUserToken.bind(this),this.getUserToken=getUserToken.bind(this),this.onUserTokenChange=onUserTokenChange.bind(this),this.clickedObjectIDsAfterSearch=clickedObjectIDsAfterSearch.bind(this),this.clickedObjectIDs=clickedObjectIDs.bind(this),this.clickedFilters=clickedFilters.bind(this),this.convertedObjectIDsAfterSearch=convertedObjectIDsAfterSearch.bind(this),this.convertedObjectIDs=convertedObjectIDs.bind(this),this.convertedFilters=convertedFilters.bind(this),this.viewedObjectIDs=viewedObjectIDs.bind(this),this.viewedFilters=viewedFilters.bind(this),this._get=get.bind(this),this.getVersion=getVersion.bind(this)};function getFunctionalInterface(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];t&&isFunction(e[t])?e[t].apply(e,n):console.warn("The method `"+t+"` doesn't exist.")}}function createInsightsClient(e){var t=getFunctionalInterface(new AlgoliaAnalytics({requestFn:e}));if("object"==typeof window&&!window.AlgoliaAnalyticsObject){var n;do{n=createUUID()}while(void 0!==window[n]);window.AlgoliaAnalyticsObject=n,window[window.AlgoliaAnalyticsObject]=t}return t.version=version,t}var requestWithSendBeacon=function(e,t){var n=JSON.stringify(t);navigator.sendBeacon(e,n)},requestWithXMLHttpRequest=function(e,t){var n=JSON.stringify(t),r=new XMLHttpRequest;r.open("POST",e),r.send(n)},requestWithNodeHttpModule=function(e,t){var n=JSON.stringify(t),r=require("url").parse(e),o={protocol:r.protocol,host:r.host,path:r.path,method:"POST",headers:{"Content-Type":"application/json","Content-Length":n.length}},i=(0,(0===e.indexOf("https://")?require("https"):require("http")).request)(o);i.on("error",function(e){console.error(e)}),i.write(n),i.end()};function getRequesterForBrowser(){if(supportsSendBeacon())return requestWithSendBeacon;if(supportsXMLHttpRequest())return requestWithXMLHttpRequest;throw new Error("Could not find a supported HTTP request client in this environment.")}function getRequesterForNode(){if(supportsNodeHttpModule())return requestWithNodeHttpModule;throw new Error("Could not find a supported HTTP request client in this environment.")}var entryNodeCjs=createInsightsClient(getRequesterForNode());exports.default=entryNodeCjs,exports.getRequesterForBrowser=getRequesterForBrowser,exports.getRequesterForNode=getRequesterForNode;
